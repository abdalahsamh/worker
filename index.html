<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>نظام حساب يومية العامل</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        margin: 0;
        padding: 20px;
        color: #333;
        min-height: 100vh;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
        background-color: #fff;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #2c3e50;
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid #eee;
      }
      .balance-container {
        background: linear-gradient(to right, #16a085, #1abc9c);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 25px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .balance {
        font-size: 2.2em;
        font-weight: bold;
        margin: 10px 0;
      }
      .buttons-container {
        display: flex;
        justify-content: center;
        gap: 25px;
        margin-bottom: 35px;
        flex-wrap: wrap;
      }
      .btn {
        padding: 18px 35px;
        font-size: 1.3em;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        min-width: 180px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .attendance {
        background: linear-gradient(to right, #27ae60, #2ecc71);
        color: white;
      }
      .overtime {
        background: linear-gradient(to right, #e67e22, #f39c12);
        color: white;
      }
      .delete {
        background: linear-gradient(to right, #e74c3c, #c0392b);
        color: white;
        padding: 12px 25px;
        font-size: 1.1em;
      }
      .btn:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }
      .input-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background-color: #fff;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        width: 350px;
        text-align: center;
      }
      .modal-title {
        margin-top: 0;
        color: #2c3e50;
      }
      .amount-input {
        width: 100%;
        padding: 15px;
        font-size: 1.2em;
        border: 2px solid #ddd;
        border-radius: 8px;
        margin: 20px 0;
        text-align: center;
        box-sizing: border-box;
      }
      .amount-input:focus {
        border-color: #3498db;
        outline: none;
      }
      .modal-buttons {
        display: flex;
        justify-content: space-between;
        gap: 15px;
      }
      .modal-btn {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1em;
        flex: 1;
      }
      .confirm-btn {
        background-color: #2ecc71;
        color: white;
      }
      .cancel-btn {
        background-color: #e74c3c;
        color: white;
      }
      .filters {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 25px;
        flex-wrap: wrap;
      }
      select {
        padding: 10px 15px;
        border-radius: 8px;
        border: 2px solid #ddd;
        background-color: white;
        font-size: 1em;
      }
      .history-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }
      .history {
        margin-top: 30px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        padding: 15px;
        text-align: center;
        border-bottom: 1px solid #ddd;
      }
      th {
        background-color: #34495e;
        color: white;
      }
      tr:hover {
        background-color: #f9f9f9;
      }
      .no-records {
        text-align: center;
        padding: 20px;
        color: #7f8c8d;
      }
      .delete-btn {
        background-color: #e74c3c;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .delete-btn:hover {
        background-color: #c0392b;
      }
      @media (max-width: 768px) {
        .buttons-container {
          flex-direction: column;
          align-items: center;
        }
        .filters {
          flex-direction: column;
          align-items: center;
        }
        .history-header {
          flex-direction: column;
          gap: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>نظام حساب يومية العامل</h1>

      <div class="balance-container">
        <div>الرصيد الحالي</div>
        <div class="balance"><span id="totalBalance">0</span> جنيه</div>
      </div>

      <div class="buttons-container">
        <button class="btn attendance" onclick="showInputModal('حضور')">
          حضور
        </button>
        <button class="btn overtime" onclick="showInputModal('سهر')">
          سهر
        </button>
      </div>

      <div class="filters">
        <select id="yearFilter" onchange="filterRecords()">
          <option value="">كل السنوات</option>
        </select>
        <select id="monthFilter" onchange="filterRecords()">
          <option value="">كل الشهور</option>
        </select>
        <select id="dayFilter" onchange="filterRecords()">
          <option value="">كل الأيام</option>
        </select>
      </div>

      <div class="history">
        <div class="history-header">
          <h2>سجل العمليات</h2>
          <button class="btn delete" onclick="showDeleteOptions()">
            مسح السجل
          </button>
        </div>
        <table id="recordsTable">
          <thead>
            <tr>
              <th>التاريخ</th>
              <th>نوع العملية</th>
              <th>القيمة</th>
              <th>الرصيد</th>
              <th>إجراءات</th>
            </tr>
          </thead>
          <tbody id="recordsBody"></tbody>
        </table>
      </div>
    </div>

    <!-- نافذة إدخال القيمة -->
    <div class="input-modal" id="inputModal">
      <div class="modal-content">
        <h3 class="modal-title" id="modalTitle">إدخال القيمة</h3>
        <input
          type="number"
          class="amount-input"
          id="amountInput"
          placeholder="أدخل القيمة بالجنيه"
          min="1"
        />
        <div class="modal-buttons">
          <button class="modal-btn cancel-btn" onclick="hideInputModal()">
            إلغاء
          </button>
          <button class="modal-btn confirm-btn" onclick="confirmAmount()">
            تأكيد
          </button>
        </div>
      </div>
    </div>

    <!-- نافذة خيارات المسح -->
    <div class="input-modal" id="deleteModal">
      <div class="modal-content">
        <h3 class="modal-title">خيارات مسح السجل</h3>
        <div
          style="
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
          "
        >
          <button
            class="modal-btn"
            onclick="deleteAllRecords()"
            style="background-color: #e74c3c"
          >
            مسح كل السجلات
          </button>
          <button
            class="modal-btn"
            onclick="deleteTodayRecords()"
            style="background-color: #e67e22"
          >
            مسح سجلات اليوم
          </button>
          <button class="modal-btn cancel-btn" onclick="hideDeleteModal()">
            إلغاء
          </button>
        </div>
      </div>
    </div>

    <script>
      let records = JSON.parse(localStorage.getItem("workerRecords")) || [];
      let balance = parseInt(localStorage.getItem("workerBalance")) || 0;
      let currentAction = "";

      const totalBalanceElement = document.getElementById("totalBalance");
      const recordsBody = document.getElementById("recordsBody");
      const yearFilter = document.getElementById("yearFilter");
      const monthFilter = document.getElementById("monthFilter");
      const dayFilter = document.getElementById("dayFilter");
      const inputModal = document.getElementById("inputModal");
      const deleteModal = document.getElementById("deleteModal");
      const modalTitle = document.getElementById("modalTitle");
      const amountInput = document.getElementById("amountInput");

      document.addEventListener("DOMContentLoaded", function () {
        updateBalance();
        displayRecords();
        populateFilterOptions();
      });

      function showInputModal(action) {
        currentAction = action;
        modalTitle.textContent = `إدخال قيمة ${action}`;
        amountInput.value = "";
        inputModal.style.display = "flex";
        amountInput.focus();
      }

      function hideInputModal() {
        inputModal.style.display = "none";
      }

      function showDeleteOptions() {
        if (records.length === 0) {
          alert("لا توجد سجلات للمسح");
          return;
        }
        deleteModal.style.display = "flex";
      }

      function hideDeleteModal() {
        deleteModal.style.display = "none";
      }

      function confirmAmount() {
        const amount = parseInt(amountInput.value);
        if (isNaN(amount) || amount <= 0) {
          alert("يرجى إدخال قيمة صحيحة");
          return;
        }
        addRecord(currentAction, amount);
        hideInputModal();
      }

      function addRecord(type, amount) {
        const now = new Date();
        const dateString = now.toLocaleDateString("ar-EG");
        const timeString = now.toLocaleTimeString("ar-EG");

        balance += amount;

        const record = {
          id: Date.now(),
          date: dateString,
          time: timeString,
          type: type,
          amount: amount,
          balance: balance,
          timestamp: now.getTime(),
          year: now.getFullYear(),
          month: now.getMonth() + 1,
          day: now.getDate(),
        };

        records.unshift(record);
        localStorage.setItem("workerRecords", JSON.stringify(records));
        localStorage.setItem("workerBalance", balance.toString());

        updateBalance();
        displayRecords();
        populateFilterOptions();

        alert(`تم تسجيل ${type} بنجاح! تم إضافة ${amount} جنيه إلى حسابك.`);
      }

      function deleteRecord(id) {
        if (!confirm("هل أنت متأكد من أنك تريد حذف هذا السجل؟")) return;

        const recordIndex = records.findIndex((record) => record.id === id);
        if (recordIndex === -1) return;

        balance -= records[recordIndex].amount;
        records.splice(recordIndex, 1);
        updateBalancesAfterDeletion();

        localStorage.setItem("workerRecords", JSON.stringify(records));
        localStorage.setItem("workerBalance", balance.toString());

        updateBalance();
        displayRecords();
        populateFilterOptions();

        alert("تم حذف السجل بنجاح");
      }

      function updateBalancesAfterDeletion() {
        let runningBalance = 0;
        for (let record of records) {
          runningBalance += record.amount;
          record.balance = runningBalance;
        }
        balance = runningBalance;
      }

      function deleteAllRecords() {
        if (!confirm("هل أنت متأكد من أنك تريد حذف كل السجلات؟")) return;
        records = [];
        balance = 0;
        localStorage.setItem("workerRecords", JSON.stringify(records));
        localStorage.setItem("workerBalance", balance.toString());
        updateBalance();
        displayRecords();
        populateFilterOptions();
        hideDeleteModal();
        alert("تم حذف جميع السجلات بنجاح");
      }

      function deleteTodayRecords() {
        const today = new Date();
        const todayDay = today.getDate();
        const todayMonth = today.getMonth() + 1;
        const todayYear = today.getFullYear();

        const todayRecords = records.filter(
          (r) =>
            r.day === todayDay && r.month === todayMonth && r.year === todayYear
        );
        if (todayRecords.length === 0) {
          alert("لا توجد سجلات لليوم");
          return;
        }
        if (
          !confirm(
            `هل أنت متأكد من أنك تريد حذف ${todayRecords.length} سجل لليوم؟`
          )
        )
          return;

        records = records.filter(
          (r) =>
            !(
              r.day === todayDay &&
              r.month === todayMonth &&
              r.year === todayYear
            )
        );
        updateBalancesAfterDeletion();

        localStorage.setItem("workerRecords", JSON.stringify(records));
        localStorage.setItem("workerBalance", balance.toString());

        updateBalance();
        displayRecords();
        populateFilterOptions();
        hideDeleteModal();

        alert("تم حذف سجلات اليوم بنجاح");
      }

      function updateBalance() {
        totalBalanceElement.textContent = balance.toLocaleString();
      }

      function displayRecords() {
        recordsBody.innerHTML = "";
        const year = yearFilter.value;
        const month = monthFilter.value;
        const day = dayFilter.value;

        const filteredRecords = records.filter((record) => {
          return (
            (!year || record.year == year) &&
            (!month || record.month == month) &&
            (!day || record.day == day)
          );
        });

        if (filteredRecords.length === 0) {
          recordsBody.innerHTML =
            '<tr><td colspan="5" class="no-records">لا توجد سجلات</td></tr>';
          return;
        }

        filteredRecords.forEach((record) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${record.date} - ${record.time}</td>
                    <td>${record.type}</td>
                    <td>+${record.amount.toLocaleString()} جنيه</td>
                    <td>${record.balance.toLocaleString()} جنيه</td>
                    <td><button class="delete-btn" onclick="deleteRecord(${
                      record.id
                    })">حذف</button></td>
                `;
          recordsBody.appendChild(row);
        });
      }

      function populateFilterOptions() {
        const years = [...new Set(records.map((record) => record.year))].sort(
          (a, b) => b - a
        );
        yearFilter.innerHTML = '<option value="">كل السنوات</option>';
        years.forEach((year) => {
          const option = document.createElement("option");
          option.value = year;
          option.textContent = year;
          yearFilter.appendChild(option);
        });

        const months = {
          1: "يناير",
          2: "فبراير",
          3: "مارس",
          4: "أبريل",
          5: "مايو",
          6: "يونيو",
          7: "يوليو",
          8: "أغسطس",
          9: "سبتمبر",
          10: "أكتوبر",
          11: "نوفمبر",
          12: "ديسمبر",
        };
        monthFilter.innerHTML = '<option value="">كل الشهور</option>';
        for (const [value, name] of Object.entries(months)) {
          const option = document.createElement("option");
          option.value = value;
          option.textContent = name;
          monthFilter.appendChild(option);
        }

        const days = [...new Set(records.map((record) => record.day))].sort(
          (a, b) => a - b
        );
        dayFilter.innerHTML = '<option value="">كل الأيام</option>';
        days.forEach((day) => {
          const option = document.createElement("option");
          option.value = day;
          option.textContent = day;
          dayFilter.appendChild(option);
        });
      }

      function filterRecords() {
        displayRecords();
      }

      window.addEventListener("click", function (event) {
        if (event.target === inputModal) hideInputModal();
        if (event.target === deleteModal) hideDeleteModal();
      });

      amountInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") confirmAmount();
      });
    </script>
  </body>
</html>
