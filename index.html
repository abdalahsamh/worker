<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>يومية العامل</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        text-align: center;
      }
      .container {
        max-width: 800px;
        margin: auto;
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      input,
      select,
      button {
        padding: 8px;
        margin: 5px;
      }
      table {
        width: 100%;
        margin-top: 15px;
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
      }
      th {
        background: #333;
        color: #fff;
      }
      .btn-danger {
        background: red;
        color: #fff;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 5px;
      }
      .btn-clear {
        background: #ff9800;
        color: #fff;
        border: none;
        padding: 8px 12px;
        margin: 5px;
        cursor: pointer;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>📒 نظام يومية العامل</h1>

      <!-- إدخال البيانات -->
      <input type="number" id="hours" placeholder="عدد الساعات" />
      <input type="number" id="rate" placeholder="سعر الساعة" />
      <select id="type">
        <option value="عادي">عادي</option>
        <option value="سهر">سهر</option>
      </select>
      <button onclick="addRecord()">➕ إضافة</button>

      <!-- الجدول -->
      <table>
        <thead>
          <tr>
            <th>اليوم</th>
            <th>عدد الساعات</th>
            <th>سعر الساعة</th>
            <th>النوع</th>
            <th>المجموع</th>
            <th>إجراء</th>
          </tr>
        </thead>
        <tbody id="recordsTable"></tbody>
      </table>

      <!-- المجموع الكلي -->
      <h3>💰 المجموع الكلي: <span id="total">0</span> جنيه</h3>
      <button class="btn-clear" onclick="clearAll()">🗑 مسح الكل</button>

      <!-- الرسوم البيانية -->
      <h2>📊 الإحصائيات</h2>
      <canvas id="barChart"></canvas>
      <canvas id="pieChart"></canvas>
    </div>

    <script>
      let records = JSON.parse(localStorage.getItem("records")) || [];

      function addRecord() {
        let hours = parseFloat(document.getElementById("hours").value);
        let rate = parseFloat(document.getElementById("rate").value);
        let type = document.getElementById("type").value;
        let date = new Date().toLocaleDateString("ar-EG");

        if (!hours || !rate) return alert("⚠ أدخل الساعات والسعر");

        let total = hours * rate;

        let record = { date, hours, rate, type, total };
        records.push(record);
        localStorage.setItem("records", JSON.stringify(records));
        renderTable();
      }

      function renderTable() {
        let table = document.getElementById("recordsTable");
        table.innerHTML = "";
        let totalAll = 0;

        records.forEach((rec, i) => {
          totalAll += rec.total;
          table.innerHTML += `
          <tr>
            <td>${rec.date}</td>
            <td>${rec.hours}</td>
            <td>${rec.rate}</td>
            <td>${rec.type}</td>
            <td>${rec.total}</td>
            <td><button class="btn-danger" onclick="deleteRecord(${i})">حذف</button></td>
          </tr>
        `;
        });

        document.getElementById("total").innerText = totalAll;
        updateCharts();
      }

      function deleteRecord(i) {
        records.splice(i, 1);
        localStorage.setItem("records", JSON.stringify(records));
        renderTable();
      }

      function clearAll() {
        if (confirm("هل أنت متأكد من مسح كل البيانات؟")) {
          records = [];
          localStorage.removeItem("records");
          renderTable();
        }
      }

      // ====== الرسوم البيانية ======
      let barCtx = document.getElementById("barChart").getContext("2d");
      let pieCtx = document.getElementById("pieChart").getContext("2d");

      let barChart = new Chart(barCtx, {
        type: "bar",
        data: {
          labels: [],
          datasets: [
            {
              label: "عدد الساعات",
              data: [],
              backgroundColor: "rgba(75,192,192,0.6)",
            },
          ],
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } },
      });

      let pieChart = new Chart(pieCtx, {
        type: "pie",
        data: {
          labels: ["عادي", "سهر"],
          datasets: [{ data: [0, 0], backgroundColor: ["#4CAF50", "#FF5722"] }],
        },
        options: { responsive: true },
      });

      function updateCharts() {
        // Bar chart
        let days = {};
        records.forEach((r) => {
          days[r.date] = (days[r.date] || 0) + r.hours;
        });
        barChart.data.labels = Object.keys(days);
        barChart.data.datasets[0].data = Object.values(days);
        barChart.update();

        // Pie chart
        let normal = records
          .filter((r) => r.type === "عادي")
          .reduce((a, b) => a + b.hours, 0);
        let night = records
          .filter((r) => r.type === "سهر")
          .reduce((a, b) => a + b.hours, 0);
        pieChart.data.datasets[0].data = [normal, night];
        pieChart.update();
      }

      // أول تحميل
      renderTable();
    </script>
  </body>
</html>
